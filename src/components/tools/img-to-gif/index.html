<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å›¾ç‰‡ç”ŸæˆGIFå·¥å…·</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft YaHei', sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        padding: 20px;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        padding: 30px;
        position: relative;
        overflow: hidden;
      }

      .container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #3498db, #2ecc71, #9b59b6, #e74c3c);
      }

      header {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
      }

      h1 {
        color: #2c3e50;
        margin-bottom: 10px;
        font-size: 2.8rem;
        background: linear-gradient(90deg, #3498db, #2ecc71);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .subtitle {
        color: #7f8c8d;
        font-size: 1.2rem;
        max-width: 600px;
        margin: 0 auto;
        line-height: 1.5;
      }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        margin-bottom: 30px;
      }

      @media (max-width: 992px) {
        .main-content {
          grid-template-columns: 1fr;
          gap: 30px;
        }
      }

      .section {
        background: #f8fafc;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        border: 1px solid #e8ecf1;
      }

      .section-title {
        color: #3498db;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e8ecf1;
        font-size: 1.4rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section-title i {
        font-size: 1.3rem;
      }

      .upload-area {
        border: 3px dashed #3498db;
        border-radius: 10px;
        padding: 50px 30px;
        text-align: center;
        background: #fff;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        margin-bottom: 25px;
        position: relative;
        overflow: hidden;
      }

      .upload-area:hover {
        background: #f0f9ff;
        transform: translateY(-3px);
        border-color: #2980b9;
        box-shadow: 0 10px 30px rgba(52, 152, 219, 0.2);
      }

      .upload-area i {
        font-size: 56px;
        color: #3498db;
        margin-bottom: 20px;
        display: block;
      }

      .upload-text {
        font-size: 1.1rem;
        color: #2c3e50;
        margin-bottom: 10px;
        font-weight: 500;
      }

      .upload-subtext {
        color: #7f8c8d;
        font-size: 0.95rem;
      }

      .file-input {
        display: none;
      }

      .image-list-container {
        background: white;
        border-radius: 10px;
        border: 1px solid #e8ecf1;
        padding: 15px;
        max-height: 350px;
        overflow-y: auto;
        margin-bottom: 20px;
      }

      .image-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
        gap: 12px;
      }

      .image-item {
        position: relative;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        border: 2px solid transparent;
      }

      .image-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        border-color: #3498db;
      }

      .image-item img {
        width: 100%;
        height: 110px;
        object-fit: cover;
        display: block;
        background: #f8f9fa;
      }

      .remove-btn {
        position: absolute;
        top: 8px;
        right: 8px;
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 50%;
        width: 28px;
        height: 28px;
        cursor: pointer;
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: all 0.3s ease;
        z-index: 2;
      }

      .image-item:hover .remove-btn {
        opacity: 1;
      }

      .remove-btn:hover {
        background: #c0392b;
        transform: scale(1.1);
      }

      .frame-number {
        position: absolute;
        bottom: 8px;
        left: 8px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
      }

      .image-counter {
        text-align: center;
        padding: 15px;
        background: linear-gradient(135deg, #f8fafc, #e8ecf1);
        border-radius: 8px;
        margin-bottom: 25px;
        font-size: 1rem;
        color: #2c3e50;
        font-weight: 500;
      }

      .controls {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        border: 1px solid #e8ecf1;
      }

      .control-group {
        margin-bottom: 25px;
      }

      .control-group label {
        display: block;
        margin-bottom: 10px;
        color: #2c3e50;
        font-weight: 600;
        font-size: 1rem;
      }

      .slider-container {
        position: relative;
        padding: 8px 0;
      }

      input[type='range'] {
        width: 100%;
        height: 8px;
        -webkit-appearance: none;
        background: linear-gradient(90deg, #3498db, #2ecc71);
        border-radius: 4px;
        outline: none;
      }

      input[type='range']::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: white;
        border: 2px solid #3498db;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        transition: all 0.2s ease;
      }

      input[type='range']::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      }

      .range-info {
        display: flex;
        justify-content: space-between;
        margin-top: 8px;
        font-size: 0.95rem;
        color: #7f8c8d;
      }

      .range-value {
        color: #3498db;
        font-weight: 600;
        font-size: 1rem;
      }

      .control-note {
        font-size: 0.9rem;
        color: #95a5a6;
        margin-top: 5px;
        line-height: 1.4;
      }

      .btn {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        border: none;
        padding: 14px 28px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        text-decoration: none;
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(52, 152, 219, 0.4);
      }

      .btn:active {
        transform: translateY(-1px);
      }

      .btn:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .btn-generate {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
      }

      .btn-generate:hover {
        box-shadow: 0 10px 25px rgba(46, 204, 113, 0.4);
      }

      .btn-secondary {
        background: linear-gradient(135deg, #95a5a6, #7f8c8d);
      }

      .btn-warning {
        background: linear-gradient(135deg, #f39c12, #e67e22);
      }

      .btn-purple {
        background: linear-gradient(135deg, #9b59b6, #8e44ad);
      }

      .button-group {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-top: 30px;
      }

      .preview-container {
        position: relative;
        min-height: 460px;
        border: 2px dashed #e8ecf1;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 25px;
        overflow: hidden;
        background: #f8fafc;
        transition: all 0.3s ease;
      }

      .preview-container.has-content {
        border-color: #3498db;
        background: white;
      }

      #previewCanvas {
        max-width: 100%;
        max-height: 400px;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        display: none;
      }

      #gifPreview {
        max-width: 100%;
        max-height: 400px;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        display: none;
      }

      .preview-placeholder {
        text-align: center;
        padding: 40px;
        color: #95a5a6;
      }

      .preview-placeholder i {
        font-size: 64px;
        margin-bottom: 20px;
        color: #bdc3c7;
        display: block;
      }

      .preview-placeholder h3 {
        font-size: 1.3rem;
        margin-bottom: 10px;
        color: #7f8c8d;
      }

      .preview-placeholder p {
        font-size: 1rem;
        color: #bdc3c7;
        max-width: 300px;
        margin: 0 auto;
        line-height: 1.5;
      }

      .loading-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.95);
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 100;
        border-radius: 12px;
      }

      .loading-spinner {
        width: 60px;
        height: 60px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        font-size: 1.1rem;
        color: #2c3e50;
        font-weight: 500;
        margin-bottom: 10px;
      }

      .progress-container {
        width: 100%;
        max-width: 400px;
        margin-top: 20px;
      }

      .progress-bar {
        width: 100%;
        height: 10px;
        background: #ecf0f1;
        border-radius: 5px;
        overflow: hidden;
        margin-bottom: 10px;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #3498db, #2ecc71);
        width: 0%;
        transition: width 0.3s ease;
        border-radius: 5px;
      }

      .progress-text {
        font-size: 0.9rem;
        color: #7f8c8d;
        text-align: center;
      }

      .result-info {
        background: linear-gradient(135deg, #f8fafc, #e8ecf1);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 25px;
        display: none;
      }

      .result-info.visible {
        display: block;
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }

      .info-item {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .info-label {
        font-size: 0.9rem;
        color: #7f8c8d;
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .info-value {
        font-size: 1.1rem;
        color: #2c3e50;
        font-weight: 600;
      }

      .tips {
        background: linear-gradient(135deg, #fff9e6, #fff3cd);
        border-left: 4px solid #f39c12;
        padding: 25px;
        border-radius: 10px;
        margin-top: 30px;
      }

      .tips h3 {
        color: #f39c12;
        margin-bottom: 15px;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .tips ul {
        padding-left: 20px;
      }

      .tips li {
        margin-bottom: 10px;
        color: #856404;
        line-height: 1.5;
      }

      .frame-controls {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .frame-controls .btn {
        padding: 10px 20px;
        font-size: 0.95rem;
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }

        h1 {
          font-size: 2.2rem;
        }

        .main-content {
          gap: 20px;
        }

        .section {
          padding: 20px;
        }

        .button-group {
          flex-direction: column;
        }

        .button-group .btn {
          width: 100%;
        }
      }

      .version {
        text-align: center;
        margin-top: 20px;
        color: #95a5a6;
        font-size: 0.9rem;
        padding-top: 20px;
        border-top: 1px solid #e8ecf1;
      }

      .gif-status {
        margin-top: 15px;
        padding: 10px;
        border-radius: 8px;
        background: #e8f4f8;
        border-left: 4px solid #3498db;
        display: none;
      }

      .gif-status.visible {
        display: block;
        animation: fadeIn 0.5s ease;
      }

      .gif-status p {
        margin: 0;
        color: #2c3e50;
        font-size: 0.95rem;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
      <header>
        <h1><i class="fas fa-film"></i> å›¾ç‰‡è½¬GIFå·¥å…·</h1>
        <p class="subtitle">ä¸Šä¼ å¤šå¼ å›¾ç‰‡ï¼Œç”Ÿæˆé«˜è´¨é‡åŠ¨æ€GIFæ–‡ä»¶ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆå’Œä¸‹è½½</p>
      </header>

      <div class="main-content">
        <!-- å·¦ä¾§ï¼šä¸Šä¼ å’Œæ§åˆ¶åŒºåŸŸ -->
        <div class="section">
          <h2 class="section-title"><i class="fas fa-upload"></i> ä¸Šä¼ å›¾ç‰‡</h2>

          <div class="upload-area" id="uploadArea">
            <i class="fas fa-cloud-upload-alt"></i>
            <div class="upload-text">ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œ</div>
            <div class="upload-subtext">æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼ï¼Œå»ºè®®å°ºå¯¸ä¸€è‡´</div>
          </div>
          <input type="file" id="fileInput" class="file-input" multiple accept="image/*" />

          <div class="image-list-container">
            <div class="image-list" id="imageList">
              <!-- å›¾ç‰‡å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            </div>
          </div>

          <div class="image-counter" id="imageCount">
            <i class="fas fa-images"></i> å·²é€‰æ‹© 0 å¼ å›¾ç‰‡
          </div>

          <div class="controls">
            <h2 class="section-title"><i class="fas fa-sliders-h"></i> è®¾ç½®å‚æ•°</h2>

            <div class="control-group">
              <label>å¸§å»¶è¿Ÿæ—¶é—´</label>
              <div class="slider-container">
                <input type="range" id="delayInput" min="50" max="1000" value="200" step="50" />
                <div class="range-info">
                  <span>å¿«</span>
                  <span class="range-value" id="delayValue">200ms</span>
                  <span>æ…¢</span>
                </div>
              </div>
              <div class="control-note">æ§åˆ¶GIFåŠ¨ç”»çš„æ’­æ”¾é€Ÿåº¦ï¼Œå€¼è¶Šå¤§åŠ¨ç”»è¶Šæ…¢</div>
            </div>

            <div class="control-group">
              <label>GIFå°ºå¯¸</label>
              <div class="slider-container">
                <input type="range" id="sizeWidthInput" min="100" max="800" value="400" step="10" />
                <div class="range-info">
                  <span>å°</span>
                  <span class="range-value" id="sizeWidthValue">400px</span>
                  <span>å®½</span>
                </div>
              </div>
              <div class="slider-container">
                <input
                  type="range"
                  id="sizeHeightInput"
                  min="100"
                  max="800"
                  value="400"
                  step="10"
                />
                <div class="range-info">
                  <span>å°</span>
                  <span class="range-value" id="sizeHeightValue">400px</span>
                  <span>é«˜</span>
                </div>
              </div>
              <!-- <div class="slider-container">
                            <input type="range" id="sizeInput" min="30" max="100" value="70" step="10">
                            <div class="range-info">
                                <span>å°</span>
                                <span class="range-value" id="sizeValue">70%</span>
                                <span>å¤§</span>
                            </div>
                        </div> -->
              <div class="control-note">è°ƒæ•´GIFçš„è¾“å‡ºå°ºå¯¸ï¼Œå½±å“æ–‡ä»¶å¤§å°</div>
            </div>

            <div class="control-group">
              <label>GIFè´¨é‡</label>
              <div class="slider-container">
                <input type="range" id="qualityInput" min="1" max="10" value="7" />
                <div class="range-info">
                  <span>ä½</span>
                  <span class="range-value" id="qualityValue">7</span>
                  <span>é«˜</span>
                </div>
              </div>
              <div class="control-note">å½±å“GIFçš„è‰²å½©è´¨é‡å’Œæ–‡ä»¶å¤§å°</div>
            </div>

            <div class="control-group">
              <label>å¾ªç¯æ¬¡æ•°</label>
              <div class="slider-container">
                <input type="range" id="loopInput" min="0" max="10" value="0" />
                <div class="range-info">
                  <span>æœ‰é™</span>
                  <span class="range-value" id="loopValue">æ— é™å¾ªç¯</span>
                  <span>æ— é™</span>
                </div>
              </div>
              <div class="control-note">0è¡¨ç¤ºæ— é™å¾ªç¯ï¼Œå…¶ä»–æ•°å­—è¡¨ç¤ºå¾ªç¯æ¬¡æ•°</div>
            </div>

            <div class="button-group">
              <button id="previewBtn" class="btn btn-generate">
                <i class="fas fa-play"></i> é¢„è§ˆåŠ¨ç”»
              </button>
              <button id="generateBtn" class="btn"><i class="fas fa-cogs"></i> ç”ŸæˆGIF</button>
              <button id="sampleBtn" class="btn btn-purple">
                <i class="fas fa-magic"></i> ç¤ºä¾‹å›¾ç‰‡
              </button>
              <button id="clearBtn" class="btn btn-secondary">
                <i class="fas fa-trash-alt"></i> æ¸…é™¤
              </button>
            </div>
          </div>
        </div>

        <!-- å³ä¾§ï¼šé¢„è§ˆå’Œç»“æœåŒºåŸŸ -->
        <div class="section">
          <h2 class="section-title"><i class="fas fa-eye"></i> GIFé¢„è§ˆä¸ä¸‹è½½</h2>

          <div class="preview-container" id="previewContainer">
            <div class="loading-overlay" id="loadingOverlay">
              <div class="loading-spinner"></div>
              <div class="loading-text" id="loadingText">æ­£åœ¨å¤„ç†...</div>
              <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                  <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0%</div>
              </div>
            </div>

            <div class="preview-placeholder" id="previewPlaceholder">
              <i class="fas fa-photo-film"></i>
              <h3>ç­‰å¾…ç”ŸæˆGIF</h3>
              <p>è¯·å…ˆä¸Šä¼ å›¾ç‰‡å¹¶è°ƒæ•´å‚æ•°ï¼Œç„¶åç‚¹å‡»"é¢„è§ˆåŠ¨ç”»"æˆ–"ç”ŸæˆGIF"</p>
            </div>

            <canvas id="previewCanvas"></canvas>
            <img id="gifPreview" alt="ç”Ÿæˆçš„GIF" />
          </div>

          <div class="frame-controls" id="frameControls" style="display: none">
            <button id="playBtn" class="btn"><i class="fas fa-play"></i> æ’­æ”¾</button>
            <button id="pauseBtn" class="btn"><i class="fas fa-pause"></i> æš‚åœ</button>
            <button id="prevFrameBtn" class="btn"><i class="fas fa-backward"></i> ä¸Šä¸€å¸§</button>
            <button id="nextFrameBtn" class="btn"><i class="fas fa-forward"></i> ä¸‹ä¸€å¸§</button>
          </div>

          <div class="gif-status" id="gifStatus">
            <p><i class="fas fa-info-circle"></i> ç‚¹å‡»æ’­æ”¾æŒ‰é’®è§‚çœ‹ç”Ÿæˆçš„åŠ¨æ€GIF</p>
          </div>

          <div class="result-info" id="resultInfo">
            <div class="info-grid">
              <div class="info-item">
                <div class="info-label"><i class="fas fa-expand-alt"></i> å°ºå¯¸</div>
                <div class="info-value" id="infoSize">0Ã—0 åƒç´ </div>
              </div>
              <div class="info-item">
                <div class="info-label"><i class="fas fa-images"></i> å¸§æ•°</div>
                <div class="info-value" id="infoFrames">0 å¸§</div>
              </div>
              <div class="info-item">
                <div class="info-label"><i class="fas fa-file"></i> æ–‡ä»¶å¤§å°</div>
                <div class="info-value" id="infoFileSize">0 KB</div>
              </div>
              <div class="info-item">
                <div class="info-label"><i class="fas fa-tachometer-alt"></i> å¸§ç‡</div>
                <div class="info-value" id="infoFps">0 FPS</div>
              </div>
            </div>
          </div>

          <div class="button-group">
            <button id="downloadBtn" class="btn btn-generate" disabled>
              <i class="fas fa-download"></i> ä¸‹è½½GIFæ–‡ä»¶
            </button>
            <button id="downloadFramesBtn" class="btn" disabled>
              <i class="fas fa-layer-group"></i> ä¸‹è½½æ‰€æœ‰å¸§
            </button>
          </div>
        </div>
      </div>

      <div class="tips">
        <h3><i class="fas fa-lightbulb"></i> ä½¿ç”¨æç¤º</h3>
        <ul>
          <li><strong>ä¸Šä¼ å›¾ç‰‡</strong>ï¼šè‡³å°‘é€‰æ‹©2å¼ å›¾ç‰‡ï¼Œå»ºè®®ä½¿ç”¨ç›¸åŒå°ºå¯¸çš„å›¾ç‰‡ä»¥è·å¾—æœ€ä½³æ•ˆæœ</li>
          <li><strong>é¢„è§ˆåŠ¨ç”»</strong>ï¼šç‚¹å‡»"é¢„è§ˆåŠ¨ç”»"å¯ä»¥å®æ—¶æŸ¥çœ‹æ•ˆæœï¼Œè°ƒæ•´å‚æ•°</li>
          <li><strong>ç”ŸæˆGIF</strong>ï¼šç‚¹å‡»"ç”ŸæˆGIF"åˆ›å»ºçœŸæ­£çš„GIFæ–‡ä»¶ï¼Œæ”¯æŒä¸‹è½½</li>
          <li><strong>å‚æ•°è°ƒæ•´</strong>ï¼šå¸§å»¶è¿Ÿæ§åˆ¶é€Ÿåº¦ï¼Œå°ºå¯¸å’Œè´¨é‡å½±å“æ–‡ä»¶å¤§å°</li>
          <li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå›¾ç‰‡æ•°é‡è¶Šå¤šã€å°ºå¯¸è¶Šå¤§ï¼Œç”Ÿæˆæ—¶é—´è¶Šé•¿</li>
          <li><strong>å…¼å®¹æ€§</strong>ï¼šç”Ÿæˆçš„GIFæ–‡ä»¶å…¼å®¹æ‰€æœ‰è®¾å¤‡å’Œå¹³å°</li>
        </ul>
      </div>

      <div class="version"><i class="fas fa-code"></i> GIFç”Ÿæˆå·¥å…· v2.0 | åŸºäºHTML5 Canvas</div>
    </div>

    <!-- å¼•å…¥GIF.jsåº“ -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.min.js"></script> -->
    <script src="./gif.min.js"></script>

    <script>
      // ä¿®å¤GIFç”Ÿæˆé—®é¢˜ - ç¡®ä¿é¢„è§ˆå’Œä¸‹è½½éƒ½æ˜¯åŠ¨æ€çš„
      class FixedGIFGenerator {
        constructor() {
          this.images = [];
          this.imageElements = [];
          this.animationInterval = null;
          this.currentFrame = 0;
          this.isPlaying = false;
          this.isGenerating = false;
          this.generatedGifUrl = null;
          this.generatedGifBlob = null;
          this.outputWidth = 400;
          this.outputHeight = 400;
          this.framesData = []; // å­˜å‚¨æ‰€æœ‰å¸§çš„Canvasæ•°æ®
          this.gif = null; // GIF.jså®ä¾‹

          this.initElements();
          this.initEventListeners();
          this.initCanvas();
          this.updateUI();
        }

        initElements() {
          // DOMå…ƒç´ 
          this.uploadArea = document.getElementById('uploadArea');
          this.fileInput = document.getElementById('fileInput');
          this.imageList = document.getElementById('imageList');
          this.imageCount = document.getElementById('imageCount');
          this.previewContainer = document.getElementById('previewContainer');
          this.previewCanvas = document.getElementById('previewCanvas');
          this.previewCtx = this.previewCanvas.getContext('2d');
          this.gifPreview = document.getElementById('gifPreview');
          this.previewPlaceholder = document.getElementById('previewPlaceholder');
          this.loadingOverlay = document.getElementById('loadingOverlay');
          this.loadingText = document.getElementById('loadingText');
          this.progressFill = document.getElementById('progressFill');
          this.progressText = document.getElementById('progressText');
          this.progressContainer = document.getElementById('progressContainer');
          this.resultInfo = document.getElementById('resultInfo');
          this.frameControls = document.getElementById('frameControls');
          this.gifStatus = document.getElementById('gifStatus');

          // æŒ‰é’®
          this.previewBtn = document.getElementById('previewBtn');
          this.generateBtn = document.getElementById('generateBtn');
          this.sampleBtn = document.getElementById('sampleBtn');
          this.clearBtn = document.getElementById('clearBtn');
          this.downloadBtn = document.getElementById('downloadBtn');
          this.downloadFramesBtn = document.getElementById('downloadFramesBtn');
          this.playBtn = document.getElementById('playBtn');
          this.pauseBtn = document.getElementById('pauseBtn');
          this.prevFrameBtn = document.getElementById('prevFrameBtn');
          this.nextFrameBtn = document.getElementById('nextFrameBtn');

          // å‚æ•°æ§åˆ¶
          this.delayInput = document.getElementById('delayInput');
          this.delayValue = document.getElementById('delayValue');
          this.sizeWidthInput = document.getElementById('sizeWidthInput');
          this.sizeWidthValue = document.getElementById('sizeWidthValue');
          this.sizeHeightInput = document.getElementById('sizeHeightInput');
          this.sizeHeightValue = document.getElementById('sizeHeightValue');
          // this.sizeInput = document.getElementById('sizeInput');
          // this.sizeValue = document.getElementById('sizeValue');
          this.qualityInput = document.getElementById('qualityInput');
          this.qualityValue = document.getElementById('qualityValue');
          this.loopInput = document.getElementById('loopInput');
          this.loopValue = document.getElementById('loopValue');

          // ä¿¡æ¯æ˜¾ç¤º
          this.infoSize = document.getElementById('infoSize');
          this.infoFrames = document.getElementById('infoFrames');
          this.infoFileSize = document.getElementById('infoFileSize');
          this.infoFps = document.getElementById('infoFps');
        }

        initEventListeners() {
          // æ–‡ä»¶ä¸Šä¼ 
          this.uploadArea.addEventListener('click', () => this.fileInput.click());
          this.fileInput.addEventListener('change', e => this.handleFileSelect(e));

          // æ‹–æ‹½ä¸Šä¼ 
          this.setupDragAndDrop();

          // å‚æ•°æ›´æ–°
          this.delayInput.addEventListener('input', () => {
            this.delayValue.textContent = `${this.delayInput.value}ms`;
            if (this.isPlaying) {
              this.restartAnimation();
            }
          });

          this.sizeWidthInput.addEventListener('input', () => {
            const width = this.sizeWidthInput.value;
            this.sizeWidthValue.textContent = `${width}px`;
            this.updateOutputSize();
          });

          this.sizeHeightInput.addEventListener('input', () => {
            const height = this.sizeHeightInput.value;
            this.sizeHeightValue.textContent = `${height}px`;
            this.updateOutputSize();
          });

          // this.sizeInput.addEventListener('input', () => {
          //     const sizePercent = this.sizeInput.value;
          //     this.sizeValue.textContent = `${sizePercent}%`;
          //     this.updateOutputSize(sizePercent);
          // });

          this.qualityInput.addEventListener('input', () => {
            this.qualityValue.textContent = this.qualityInput.value;
          });

          this.loopInput.addEventListener('input', () => {
            const value = this.loopInput.value;
            this.loopValue.textContent = value === '0' ? 'æ— é™å¾ªç¯' : `${value}æ¬¡`;
          });

          // æŒ‰é’®äº‹ä»¶
          this.previewBtn.addEventListener('click', () => this.startPreview());
          this.generateBtn.addEventListener('click', () => this.generateGIF());
          this.sampleBtn.addEventListener('click', () => this.addSampleImages());
          this.clearBtn.addEventListener('click', () => this.clearAll());
          this.downloadBtn.addEventListener('click', () => this.downloadGIF());
          this.downloadFramesBtn.addEventListener('click', () => this.downloadAllFrames());

          // åŠ¨ç”»æ§åˆ¶
          this.playBtn.addEventListener('click', () => this.playAnimation());
          this.pauseBtn.addEventListener('click', () => this.pauseAnimation());
          this.prevFrameBtn.addEventListener('click', () => this.prevFrame());
          this.nextFrameBtn.addEventListener('click', () => this.nextFrame());
        }

        initCanvas() {
          this.previewCanvas.width = this.outputWidth;
          this.previewCanvas.height = this.outputHeight;
          this.drawWelcomeScreen();
        }

        updateOutputSize() {
          const width = this.sizeWidthInput.value;
          const height = this.sizeHeightInput.value;
          this.outputWidth = width;
          this.outputHeight = height;
          this.previewCanvas.width = width;
          this.previewCanvas.height = height;

          if (this.isPlaying || this.imageElements.length > 0) {
            this.drawFrame(this.currentFrame);
          }
        }

        drawWelcomeScreen() {
          const ctx = this.previewCtx;
          const w = this.previewCanvas.width;
          const h = this.previewCanvas.height;

          // æ¸å˜èƒŒæ™¯
          const gradient = ctx.createLinearGradient(0, 0, w, h);
          gradient.addColorStop(0, '#f8f9fa');
          gradient.addColorStop(1, '#e9ecef');
          ctx.fillStyle = gradient;
          ctx.fillRect(0, 0, w, h);

          // å›¾æ ‡
          ctx.fillStyle = '#3498db';
          ctx.font = 'bold 48px "Microsoft YaHei", sans-serif';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText('ğŸ–¼ï¸', w / 2, h / 2 - 40);

          // æ ‡é¢˜
          ctx.fillStyle = '#2c3e50';
          ctx.font = 'bold 24px "Microsoft YaHei", sans-serif';
          ctx.fillText('GIFç”Ÿæˆå·¥å…·', w / 2, h / 2 + 10);

          // è¯´æ˜
          ctx.fillStyle = '#7f8c8d';
          ctx.font = '16px "Microsoft YaHei", sans-serif';
          ctx.fillText('ä¸Šä¼ å›¾ç‰‡å¼€å§‹åˆ¶ä½œåŠ¨ç”»', w / 2, h / 2 + 50);
        }

        setupDragAndDrop() {
          this.uploadArea.addEventListener('dragover', e => {
            e.preventDefault();
            this.uploadArea.style.borderColor = '#3498db';
            this.uploadArea.style.background = '#f0f9ff';
          });

          this.uploadArea.addEventListener('dragleave', () => {
            this.uploadArea.style.borderColor = '#3498db';
            this.uploadArea.style.background = '#fff';
          });

          this.uploadArea.addEventListener('drop', e => {
            e.preventDefault();
            this.uploadArea.style.borderColor = '#3498db';
            this.uploadArea.style.background = '#fff';
            const files = Array.from(e.dataTransfer.files);
            if (files.length > 0) {
              this.handleFileSelect({ target: { files } });
            }
          });
        }

        async handleFileSelect(event) {
          const files = Array.from(event.target.files);
          if (files.length === 0) return;

          const validFiles = files.filter(file => file.type.startsWith('image/'));

          if (validFiles.length === 0) return;

          if (this.images.length + validFiles.length > 50) return;

          await this.loadImages(validFiles);
          this.fileInput.value = '';
        }

        async loadImages(files) {
          this.showLoading('æ­£åœ¨åŠ è½½å›¾ç‰‡...');

          for (const file of files) {
            try {
              const imageData = await this.readFileAsImage(file);
              this.images.push(imageData);
            } catch (error) {
              console.error('åŠ è½½å›¾ç‰‡å¤±è´¥:', error);
            }
          }

          this.updateImageList();
          this.updateUI();
          this.hideLoading();
        }

        readFileAsImage(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = e => {
              const img = new Image();
              img.onload = () => {
                resolve({
                  id: Date.now() + Math.random(),
                  dataUrl: e.target.result,
                  name: file.name,
                  size: file.size,
                  width: img.width,
                  height: img.height,
                  element: img
                });
              };
              img.onerror = reject;
              img.src = e.target.result;
            };
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
        }

        updateImageList() {
          this.imageList.innerHTML = '';
          this.imageCount.innerHTML = `<i class="fas fa-images"></i> å·²é€‰æ‹© ${this.images.length} å¼ å›¾ç‰‡`;

          this.images.forEach((img, index) => {
            const div = document.createElement('div');
            div.className = 'image-item';
            div.innerHTML = `
                        <img src="${img.dataUrl}" alt="å›¾ç‰‡ ${index + 1}">
                        <button class="remove-btn" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="frame-number">${index + 1}</div>
                    `;

            const removeBtn = div.querySelector('.remove-btn');
            removeBtn.addEventListener('click', e => {
              e.stopPropagation();
              this.removeImage(index);
            });

            this.imageList.appendChild(div);
          });
        }

        removeImage(index) {
          this.images.splice(index, 1);
          this.updateImageList();
          this.updateUI();
          if (this.isPlaying) {
            this.pauseAnimation();
          }
        }

        clearAll() {
          if (this.images.length === 0) return;

          if (confirm(`ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ ${this.images.length} å¼ å›¾ç‰‡å—ï¼Ÿ`)) {
            this.images = [];
            this.imageElements = [];
            this.framesData = [];
            this.updateImageList();
            this.updateUI();
            this.pauseAnimation();
            this.clearGeneratedGif();
            this.previewPlaceholder.style.display = 'block';
            this.previewCanvas.style.display = 'none';
            this.gifPreview.style.display = 'none';
            this.frameControls.style.display = 'none';
            this.resultInfo.classList.remove('visible');
            this.gifStatus.classList.remove('visible');
            this.drawWelcomeScreen();
          }
        }

        clearGeneratedGif() {
          if (this.generatedGifUrl) {
            URL.revokeObjectURL(this.generatedGifUrl);
            this.generatedGifUrl = null;
            this.generatedGifBlob = null;
          }
          this.gifPreview.src = '';
          this.downloadBtn.disabled = true;
        }

        updateUI() {
          const hasEnoughImages = this.images.length >= 2;
          this.previewBtn.disabled = !hasEnoughImages;
          this.generateBtn.disabled = !hasEnoughImages;
          this.clearBtn.disabled = this.images.length === 0;
          this.playBtn.disabled = !hasEnoughImages || !this.isPlaying;
          this.pauseBtn.disabled = !hasEnoughImages || !this.isPlaying;
          this.downloadFramesBtn.disabled = this.imageElements.length === 0;
        }

        showLoading(message) {
          this.loadingText.textContent = message;
          this.loadingOverlay.style.display = 'flex';
        }

        hideLoading() {
          this.loadingOverlay.style.display = 'none';
        }

        updateProgress(current, total, message) {
          const percent = Math.round((current / total) * 100);
          this.progressFill.style.width = `${percent}%`;
          this.progressText.textContent = `${message} (${current}/${total})`;
        }

        async startPreview() {
          if (this.images.length < 2) return;

          this.showLoading('æ­£åœ¨å‡†å¤‡åŠ¨ç”»é¢„è§ˆ...');

          try {
            // å‡†å¤‡å›¾ç‰‡å…ƒç´ 
            this.imageElements = this.images.map(img => img.element);

            // æ˜¾ç¤ºCanvas
            this.previewPlaceholder.style.display = 'none';
            this.previewCanvas.style.display = 'block';
            this.gifPreview.style.display = 'none';
            this.frameControls.style.display = 'flex';
            this.previewContainer.classList.add('has-content');
            this.gifStatus.classList.remove('visible');

            // å¼€å§‹åŠ¨ç”»
            this.startAnimation();

            this.hideLoading();
          } catch (error) {
            console.error('é¢„è§ˆå¤±è´¥:', error);
            this.hideLoading();
          }
        }

        startAnimation() {
          this.pauseAnimation();
          this.isPlaying = true;
          this.currentFrame = 0;

          // ç»˜åˆ¶ç¬¬ä¸€å¸§
          this.drawFrame(this.currentFrame);

          // è®¾ç½®åŠ¨ç”»é—´éš”
          const delay = parseInt(this.delayInput.value);
          this.animationInterval = setInterval(() => {
            this.currentFrame = (this.currentFrame + 1) % this.imageElements.length;
            this.drawFrame(this.currentFrame);
          }, delay);

          this.updateUI();
          this.updateResultInfo();
        }

        restartAnimation() {
          if (this.isPlaying) {
            this.pauseAnimation();
            this.startAnimation();
          }
        }

        drawFrame(frameIndex) {
          if (!this.imageElements || this.imageElements.length === 0) return;

          const img = this.imageElements[frameIndex];
          const ctx = this.previewCtx;
          const w = this.previewCanvas.width;
          const h = this.previewCanvas.height;

          // æ¸…ç©ºç”»å¸ƒ
          ctx.clearRect(0, 0, w, h);

          // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼ˆä¿æŒå®½é«˜æ¯”ï¼‰
          const scale = Math.min(w / img.width, h / img.height);
          const width = img.width * scale;
          const height = img.height * scale;
          const x = (w - width) / 2;
          const y = (h - height) / 2;

          // ç»˜åˆ¶ç™½è‰²èƒŒæ™¯
          ctx.fillStyle = 'white';
          ctx.fillRect(0, 0, w, h);

          // ç»˜åˆ¶å›¾ç‰‡
          ctx.drawImage(img, x, y, width, height);

          // ç»˜åˆ¶å¸§ä¿¡æ¯
          ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
          ctx.fillRect(10, 10, 140, 50);
          ctx.fillStyle = 'white';
          ctx.font = '14px "Microsoft YaHei", sans-serif';
          ctx.textAlign = 'left';
          ctx.textBaseline = 'top';
          ctx.fillText(`å¸§: ${frameIndex + 1}/${this.imageElements.length}`, 20, 20);
          ctx.fillText(`å»¶è¿Ÿ: ${this.delayInput.value}ms`, 20, 40);

          this.currentFrame = frameIndex;
        }

        playAnimation() {
          if (this.imageElements.length === 0) return;

          if (!this.isPlaying) {
            this.startAnimation();
          }
        }

        pauseAnimation() {
          if (this.animationInterval) {
            clearInterval(this.animationInterval);
            this.animationInterval = null;
          }
          this.isPlaying = false;
          this.updateUI();
        }

        prevFrame() {
          if (this.imageElements.length === 0) return;
          this.currentFrame =
            (this.currentFrame - 1 + this.imageElements.length) % this.imageElements.length;
          this.drawFrame(this.currentFrame);
          if (this.isPlaying) {
            this.pauseAnimation();
          }
        }

        nextFrame() {
          if (this.imageElements.length === 0) return;
          this.currentFrame = (this.currentFrame + 1) % this.imageElements.length;
          this.drawFrame(this.currentFrame);
          if (this.isPlaying) {
            this.pauseAnimation();
          }
        }

        updateResultInfo() {
          if (this.generatedGifBlob) {
            this.infoSize.textContent = `${this.outputWidth}Ã—${this.outputHeight} åƒç´ `;
            this.infoFrames.textContent = `${this.imageElements.length} å¸§`;
            this.infoFileSize.textContent = `${(this.generatedGifBlob.size / 1024).toFixed(2)} KB`;

            const delay = parseInt(this.delayInput.value);
            this.infoFps.textContent = delay > 0 ? `${Math.round(1000 / delay)} FPS` : '0 FPS';

            this.resultInfo.classList.add('visible');
          } else if (this.imageElements.length > 0) {
            this.infoSize.textContent = `${this.outputWidth}Ã—${this.outputHeight} åƒç´ `;
            this.infoFrames.textContent = `${this.imageElements.length} å¸§`;

            // ä¼°ç®—æ–‡ä»¶å¤§å°
            let totalSize = 0;
            this.images.forEach(img => {
              totalSize += img.size || 1024;
            });
            this.infoFileSize.textContent = `${(totalSize / 1024).toFixed(2)} KB`;

            const delay = parseInt(this.delayInput.value);
            this.infoFps.textContent = delay > 0 ? `${Math.round(1000 / delay)} FPS` : '0 FPS';

            this.resultInfo.classList.add('visible');
          }
        }

        async generateGIF() {
          if (this.isGenerating) return;

          if (this.images.length < 2) return;

          this.isGenerating = true;
          this.showLoading('æ­£åœ¨ç”ŸæˆGIFæ–‡ä»¶...');

          try {
            // æ¸…ç†ä¹‹å‰çš„GIF
            this.clearGeneratedGif();

            // å‡†å¤‡å›¾ç‰‡å…ƒç´ 
            this.imageElements = this.images.map(img => img.element);

            // è·å–GIFå‚æ•°
            const delay = parseInt(this.delayInput.value);
            const loop = parseInt(this.loopInput.value);
            const quality = Math.max(1, parseInt(this.qualityInput.value));

            // ä½¿ç”¨GIF.jsåˆ›å»ºçœŸæ­£çš„åŠ¨æ€GIF
            this.generatedGifBlob = await this.createGIFWithGIFJS(delay, loop, quality);

            if (!this.generatedGifBlob) {
              throw new Error('GIFç”Ÿæˆå¤±è´¥');
            }

            this.generatedGifUrl = URL.createObjectURL(this.generatedGifBlob);

            // æ˜¾ç¤ºç”Ÿæˆçš„GIF
            this.previewPlaceholder.style.display = 'none';
            this.previewCanvas.style.display = 'none';
            this.gifPreview.src = this.generatedGifUrl;
            this.gifPreview.style.display = 'block';
            this.frameControls.style.display = 'none';
            this.previewContainer.classList.add('has-content');
            this.gifStatus.classList.add('visible');

            // ç­‰å¾…GIFåŠ è½½å®Œæˆ
            await new Promise(resolve => {
              this.gifPreview.onload = resolve;
              this.gifPreview.onerror = () => {
                console.error('GIFåŠ è½½å¤±è´¥');
                resolve();
              };
              // è®¾ç½®è¶…æ—¶
              setTimeout(resolve, 1000);
            });

            // æ›´æ–°UI
            this.downloadBtn.disabled = false;
            this.updateResultInfo();

            this.hideLoading();
          } catch (error) {
            console.error('ç”ŸæˆGIFå¤±è´¥:', error);
            this.hideLoading();
            alert('ç”ŸæˆGIFå¤±è´¥ï¼Œè¯·é‡è¯•æˆ–å‡å°‘å›¾ç‰‡æ•°é‡');
          } finally {
            this.isGenerating = false;
          }
        }

        // ä½¿ç”¨GIF.jsåˆ›å»ºåŠ¨æ€GIF
        createGIFWithGIFJS(delay, loop, quality) {
          return new Promise((resolve, reject) => {
            try {
              // åˆ›å»ºGIFå®ä¾‹
              const gif = new GIF({
                workers: 2,
                quality: quality * 10, // GIF.jsçš„è´¨é‡èŒƒå›´æ˜¯1-100
                width: this.outputWidth,
                height: this.outputHeight,
                // workerScript: 'https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.worker.js',
                workerScript: './gif.worker.js',
                repeat: loop === 0 ? 0 : loop,
                background: '#FFFFFF',
                dither: 'FloydSteinberg',
                debug: false
              });

              // åˆ›å»ºä¸´æ—¶canvas
              const canvas = document.createElement('canvas');
              canvas.width = this.outputWidth;
              canvas.height = this.outputHeight;
              const ctx = canvas.getContext('2d');

              // æ·»åŠ æ‰€æœ‰å¸§
              let framesProcessed = 0;

              const addFrame = index => {
                if (index >= this.imageElements.length) {
                  // æ‰€æœ‰å¸§å·²æ·»åŠ ï¼Œå¼€å§‹æ¸²æŸ“
                  gif.on('finished', blob => {
                    resolve(blob);
                  });

                  gif.on('progress', p => {
                    const percent = Math.round(p * 100);
                    this.updateProgress(percent, 100, 'æ¸²æŸ“GIF');
                  });

                  gif.render();
                  return;
                }

                const img = this.imageElements[index];

                // æ¸…ç©ºcanvas
                ctx.clearRect(0, 0, this.outputWidth, this.outputHeight);

                // ç»˜åˆ¶ç™½è‰²èƒŒæ™¯
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, this.outputWidth, this.outputHeight);

                // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼ˆä¿æŒå®½é«˜æ¯”ï¼‰
                const scale = Math.min(
                  this.outputWidth / img.width,
                  this.outputHeight / img.height
                );
                const width = img.width * scale;
                const height = img.height * scale;
                const x = (this.outputWidth - width) / 2;
                const y = (this.outputHeight - height) / 2;

                // ç»˜åˆ¶å›¾ç‰‡ï¼ˆä¸ç»˜åˆ¶å¸§å·ä¿¡æ¯ï¼‰
                ctx.drawImage(img, x, y, width, height);

                // æ·»åŠ å¸§åˆ°GIF
                gif.addFrame(canvas, { delay: delay, copy: true });

                framesProcessed++;
                this.updateProgress(framesProcessed, this.imageElements.length, 'æ·»åŠ å¸§');

                // ç»§ç»­æ·»åŠ ä¸‹ä¸€å¸§ï¼ˆä½¿ç”¨setTimeouté¿å…é˜»å¡UIï¼‰
                setTimeout(() => addFrame(index + 1), 10);
              };

              // å¼€å§‹æ·»åŠ å¸§
              addFrame(0);
            } catch (error) {
              console.error('GIF.jsç”Ÿæˆå¤±è´¥:', error);
              reject(error);
            }
          });
        }

        downloadGIF() {
          if (!this.generatedGifBlob || !this.generatedGifUrl) return;

          const a = document.createElement('a');
          a.href = this.generatedGifUrl;
          a.download = `gif_animation_${Date.now()}.gif`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);

          // æ˜¾ç¤ºä¸‹è½½æˆåŠŸæç¤º
          const originalText = this.gifStatus.innerHTML;
          this.gifStatus.innerHTML = '<p><i class="fas fa-check-circle"></i> GIFä¸‹è½½å·²å¼€å§‹ï¼</p>';
          setTimeout(() => {
            this.gifStatus.innerHTML = originalText;
          }, 3000);
        }

        async downloadAllFrames() {
          if (this.imageElements.length === 0) return;

          try {
            this.showLoading('æ­£åœ¨å‡†å¤‡å›¾ç‰‡æ–‡ä»¶...');

            // åˆ›å»ºä¸€ä¸ªZIPæ–‡ä»¶ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼Œç›´æ¥ä¸‹è½½æ‰€æœ‰å›¾ç‰‡ï¼‰
            for (let i = 0; i < this.imageElements.length; i++) {
              const canvas = document.createElement('canvas');
              const ctx = canvas.getContext('2d');
              const img = this.imageElements[i];

              canvas.width = img.width;
              canvas.height = img.height;
              ctx.drawImage(img, 0, 0);

              // å°†æ¯å¼ å›¾ç‰‡å•ç‹¬ä¸‹è½½
              const dataUrl = canvas.toDataURL('image/png');
              const a = document.createElement('a');
              a.href = dataUrl;
              a.download = `frame_${String(i + 1).padStart(3, '0')}.png`;
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);

              // çŸ­æš‚å»¶è¿Ÿï¼Œé¿å…æµè§ˆå™¨é™åˆ¶
              await new Promise(resolve => setTimeout(resolve, 100));

              // æ›´æ–°è¿›åº¦
              this.updateProgress(
                i + 1,
                this.imageElements.length,
                `ä¸‹è½½å›¾ç‰‡ ${i + 1}/${this.imageElements.length}`
              );
            }

            this.hideLoading();
          } catch (error) {
            console.error('ä¸‹è½½å¤±è´¥:', error);
            this.hideLoading();
          }
        }

        async addSampleImages() {
          // æ¸…é™¤ç°æœ‰å›¾ç‰‡
          this.images = [];
          this.updateImageList();
          this.showLoading('æ­£åœ¨åˆ›å»ºç¤ºä¾‹å›¾ç‰‡...');

          // åˆ›å»º4å¼ ç¤ºä¾‹å›¾ç‰‡
          const colors = ['#3498db', '#2ecc71', '#e74c3c', '#9b59b6'];
          const texts = ['å¸§ 1', 'å¸§ 2', 'å¸§ 3', 'å¸§ 4'];
          const width = this.outputWidth;
          const height = this.outputHeight;

          for (let i = 0; i < 4; i++) {
            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');

            // æ¸å˜èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, width, height);
            gradient.addColorStop(0, colors[i]);
            gradient.addColorStop(1, this.lightenColor(colors[i], 40));
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);

            // åœ†å½¢
            ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.beginPath();
            ctx.arc(width / 2, height / 2, 100, 0, Math.PI * 2);
            ctx.fill();

            // æ–‡å­—
            ctx.fillStyle = 'white';
            ctx.font = 'bold 36px "Microsoft YaHei", sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(texts[i], width / 2, height / 2);

            // å°å­—
            ctx.font = '24px "Microsoft YaHei", sans-serif';
            ctx.fillText('ç¤ºä¾‹åŠ¨ç”»', width / 2, height / 2 + 50);

            const dataUrl = canvas.toDataURL('image/png');
            const img = new Image();
            img.src = dataUrl;

            await new Promise(resolve => {
              img.onload = () => {
                this.images.push({
                  id: Date.now() + Math.random(),
                  dataUrl,
                  name: `ç¤ºä¾‹å›¾ç‰‡${i + 1}.png`,
                  size: 1024,
                  width,
                  height,
                  element: img
                });
                resolve();
              };
            });

            // æ›´æ–°è¿›åº¦
            this.updateProgress(i + 1, 4, 'åˆ›å»ºç¤ºä¾‹å›¾ç‰‡');

            // çŸ­æš‚å»¶è¿Ÿï¼Œé¿å…ç•Œé¢å¡é¡¿
            await new Promise(resolve => setTimeout(resolve, 50));
          }

          this.updateImageList();
          this.updateUI();
          this.hideLoading();
        }

        lightenColor(color, percent) {
          const num = parseInt(color.replace('#', ''), 16);
          const amt = Math.round(2.55 * percent);
          const R = Math.min(255, (num >> 16) + amt);
          const G = Math.min(255, ((num >> 8) & 0x00ff) + amt);
          const B = Math.min(255, (num & 0x0000ff) + amt);

          return '#' + (0x1000000 + R * 0x10000 + G * 0x100 + B).toString(16).slice(1);
        }
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
      document.addEventListener('DOMContentLoaded', () => {
        window.gifGenerator = new FixedGIFGenerator();
      });
    </script>
  </body>
</html>
