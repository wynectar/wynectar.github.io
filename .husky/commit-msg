#!/bin/bash

# Get commit message file path
COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Process commit message with awk
awk '
BEGIN {
  # Define emoji mapping
  emojis["feat"] = "🚀"
  emojis["fix"] = "🐛"
  emojis["docs"] = "📚"
  emojis["style"] = "🎨"
  emojis["refactor"] = "♻️"
  emojis["perf"] = "⚡️"
  emojis["test"] = "🧪"
  emojis["build"] = "📦"
  emojis["ci"] = "👷"
  emojis["chore"] = "🔧"
  emojis["revert"] = "⏪"
}
{
  # Match conventional commit format
  if ($0 ~ /^[a-z]+(\([^)]*\))?:/) {
    split($0, parts, /[:\(\)]/)
    type = parts[1]
    if (type in emojis) {
      # Insert emoji after type
      sub(/^[a-z]+/, "&" emojis[type])
    }
  }
  print $0
}' "$COMMIT_MSG_FILE" > "$COMMIT_MSG_FILE.tmp"

# Replace original commit message
mv "$COMMIT_MSG_FILE.tmp" "$COMMIT_MSG_FILE"